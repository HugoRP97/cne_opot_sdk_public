version: "3.9"
services:
  node1:
    build: ./node
    environment:
      - NETCONF_PORT=830
      - OPOT_CONTROLLER_IP=192.168.165.2
      - LOGS_PATH=/tmp
      - INTERFACES_TO_LISTEN=eth1
    networks:
      proxy:
        ipv4_address: 10.0.0.2
      net1:
        ipv4_address: 10.1.1.3
      management:
        ipv4_address: 192.168.165.101
    volumes:
      - "./node/config_files:/config/"
    cap_add:
      - NET_ADMIN
  node2:
        build: ./node
        environment:
          - NETCONF_PORT=830
          - OPOT_CONTROLLER_IP=192.168.165.2
          - LOGS_PATH=/tmp
          - INTERFACES_TO_LISTEN=eth1
        networks:
          proxy:
            ipv4_address: 10.0.0.3
          management:
            ipv4_address: 192.168.165.102
        volumes:
          - "./node/config_files:/config/"
        cap_add:
          - NET_ADMIN
  node3:
    build: ./node
    environment:
      - NETCONF_PORT=830
      - OPOT_CONTROLLER_IP=192.168.165.2
      - LOGS_PATH=/tmp
      - INTERFACES_TO_LISTEN=eth1
    networks:
      proxy:
        ipv4_address: 10.0.0.4
      management:
        ipv4_address: 192.168.165.103
    volumes:
      - "./node/config_files:/config/"
    cap_add:
      - NET_ADMIN
  node4:
    build: ./node
    environment:
      - NETCONF_PORT=830
      - OPOT_CONTROLLER_IP=192.168.165.2
      - LOGS_PATH=/tmp
      - INTERFACES_TO_LISTEN=eth1
      - FORCE_ERROR=1
    networks:
      proxy:
        ipv4_address: 10.0.0.5
      net2:
        ipv4_address: 10.1.2.3
      management:
        ipv4_address: 192.168.165.104
    volumes:
      - "./node/config_files:/config/"
    cap_add:
      - NET_ADMIN
  controller:
    build: ./controller
    environment:
      - OPOT_CONTROLLER_IP=192.168.165.2
      - OPEN_API_IP=0.0.0.0
    networks:
      management:
        ipv4_address: 192.168.165.2
    command:
      - "bash"
      - "/entrypoint.sh"

# TODO modify this part to make the networks independent from the current setup
networks:
  management:
    external: true
    name: management
  proxy:
    external: true
    name: proxy
  net1:
    external: true
    name: net1
  net2:
    external: true
    name: net2


